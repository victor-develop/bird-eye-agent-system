# 文件格式规范

本文档定义 Bird-Eye Agent 系统中所有关键文件的格式。

---

## Mission Root readme.md

位置：`<mission-root>/readme.md`

用途：记录任务背景、目标和当前状态概述。

### 模板

```markdown
# Mission: <任务名称>

## 背景
<为什么需要这个任务？问题是什么？>

## 目标
<完成这个任务后的预期结果>

## 范围
### 包含
- <明确要做的事项>

### 不包含
- <明确不做的事项>

## 关键约束
- <技术、资源等约束>

## 当前状态
<简要描述当前进展，由 TreeWork 维护>

## 变更记录
| 日期 | 变更内容 |
|------|----------|
| YYYY-MM-DD | 初始创建 |
```

### 约束
- 不超过 **150 行**
- 上下文涉及的文件放到 `references.yaml`

---

## references.yaml

位置：`<mission-root>/references.yaml` 或 `<task-dir>/references.yaml`

用途：列出完成任务所需的上下文文件路径。

### 格式

```yaml
- path: docs/architecture-design.md
  desc: 系统整体架构

- path: backend/internal/service/product.go
  desc: 商品服务现有实现

- path: backend/internal/repos/product_repo.go
  desc: 商品数据访问层

- path: docs/prds/csv-import.md
  desc: CSV 导入功能需求文档
```

### 字段说明
| 字段 | 必填 | 说明 |
|------|------|------|
| path | 是 | 相对于项目根目录的文件路径 |
| desc | 是 | 为什么需要阅读这个文件 |

### 生成规则
- 每个 task 目录有独立的 `references.yaml`
- 由 TreeWork 根据任务性质从 mission 上下文中**裁剪生成**
- 只包含该任务**真正需要**的文件引用
- TaskRunner 按此清单读取上下文，无需自行判断

---

## progress.md

位置：`<mission-root>/progress.md`

用途：使用 ASCII 树状图可视化任务进度。

### 模板

```markdown
# Progress

## 当前焦点
Task 1.2.2.1 - <简短描述>

## 任务树

[状态]Task编号: 描述
     │
     ▼
[状态]Task编号: 描述
     │
     ├───►[状态]Task编号: 描述
     │
     └───►[状态]Task编号: 描述

## 状态图例
- [  ] 已规划（待准备）
- [..] 进行中（已创建 readme.md）
- [ok] 已完成
- [bin] 已废弃

## 备注
<任何需要记录的注释>
```

### ASCII 图符号说明

```
符号        含义
────────────────────────────
│           顺序依赖（垂直）
▼           指向下一个任务
├───►       子任务分支（有后续兄弟）
└───►       子任务分支（最后一个）
```

### 示例

```
   [ok]Task1.1: 需求分析
        │
        ▼
   [..]Task1.2: 系统设计
        │
        ├───►[ok]Task1.2.1: 数据库设计
        │
        ├───►[>>]Task1.2.2: API 设计
        │         │
        │         ├───►[>>]Task1.2.2.1: GraphQL Schema
        │         │
        │         └───►[..]Task1.2.2.2: HTTP Endpoints
        │
        └───►[..]Task1.2.3: 前端设计
```

---

## 任务目录 readme.md

位置：`<task-dir>/readme.md`

用途：TaskRunner 的输入，定义单个任务的详细要求。

### 模板

```markdown
# Task: <任务编号> - <任务名称>

> 输出位置：任务完成后在填写本目录下的 `result.md`, 不要超过 150 行

## 任务目标
<清晰描述要完成什么>

## 验收标准
- [ ] 标准 1：<具体可验证的条件>
- [ ] 标准 2：<具体可验证的条件>
- [ ] 标准 3：<具体可验证的条件>

## 上下文
<必要的背景信息，或引用>

参考文件见 `references.yaml`

## 实现指引
<可选：提供实现思路或关键点>

## 约束
- <技术约束>
- <代码风格约束>
- <不要做的事情>

## 相关任务
- 前置任务：Task X.X（已完成）
- 后续任务：Task X.X（待规划）
```

### 关键原则
1. **目标明确**：读完应该知道"做什么"
2. **标准可验**：验收标准应该是可检查的
3. **上下文充分**：不需要额外搜索就能开始
4. **边界清晰**：知道什么不该做

---

## result.md

位置：`<task-dir>/result.md`

用途：TaskRunner 的输出，记录执行结果。

### 模板

```markdown
# Task Result: <任务编号>

## 执行状态
- [ ] 成功
- [ ] 部分成功
- [ ] 失败

## 执行摘要
<2-3 句话描述做了什么>

## 变更文件列表
| 文件路径 | 变更类型 | 说明 |
|----------|----------|------|
| path/to/file | 新增/修改/删除 | 简短说明 |

## 关键决策
<可选：执行过程中的重要决策>

## 遗留问题
<可选：未解决的问题>

## 验收检查
- [x] 标准 1
- [x] 标准 2
- [ ] 标准 3（原因：xxx）
```

### 变更类型
| 类型 | 说明 |
|------|------|
| 新增 | 创建了新文件 |
| 修改 | 修改了现有文件 |
| 删除 | 删除了文件 |
| 重命名 | 文件重命名或移动 |
